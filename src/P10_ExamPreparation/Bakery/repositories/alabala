<?xml version="1.0" encoding="UTF-8"?>

<dynamic-element-script engine="nashorn" main-script="true">
  <name>InverseSpreadWIthInterpolation</name>
  <script><![CDATA[

var CodeProperty = Java.type("element.property.CodeProperty");
var BigDecimal = Java.type("java.math.BigDecimal");
var RoundingMode = Java.type("java.math.RoundingMode");
var applicabilityDate = query.reference("applicabilityDate");

var snap = parameters.get("snap");
var sourceQuoteType = parameters.get("sourceQuoteType");
var targetQuoteType = parameters.get("targetQuoteType");
var targetSnap = parameters.get("targetSnap");
var subjectId = parameters.get("subjectId");

result = instrumentHelper2(sourceQuoteType, sourceQuoteType, applicabilityDate, snap, subjectId);
var it = result.iterator();
while (it.hasNext()) {
var price = it.next();
var value = price.getAttribute("value");
var mostRecentCorrectedElementApplicabilityDate = price.getAttribute("correctedApplicabilityDate");
resultPrc = createPriceElement(price, targetQuoteType, value, mostRecentCorrectedElementApplicabilityDate);
resultPrc.setReference("snap", targetSnap);
result.add(resultPrc);
}
]]></script>
  <description>I1 + I2 - I3</description>
  <dependency>CalculationFunctions</dependency>
  <dependency>BasicElementCreator</dependency>
  <dependency>InstrumentPriceHelper2</dependency>
  <parameter name="snap0" required="true" type="Code"/>
  <parameter name="snap1" required="true" type="Code"/>
  <parameter name="snap2" required="true" type="Code"/>
  <parameter name="snap3" required="true" type="Code"/>
  <parameter name="sourceQuoteType1" required="true" type="Code"/>
  <parameter name="sourceQuoteType2" required="true" type="Code"/>
  <parameter name="sourceQuoteType3" required="true" type="Code"/>
  <parameter name="targetQuoteType" required="true" type="Code"/>
  <parameter name="subjectId1" required="true" type="SubjectId"/>
  <parameter name="subjectId2" required="true" type="SubjectId"/>
  <parameter name="subjectId3" required="true" type="SubjectId"/>
</dynamic-element-script>
